<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Net::sFlow - decode sFlow datagrams</title>
<link rev="made" href="mailto:root@b07.apple.com" />
</head>

<body style="background-color: white">

<p><a name="__index__"></a></p>
<!-- INDEX BEGIN -->

<ul>

	<li><a href="#name">NAME</a></li>
	<li><a href="#synopsis">SYNOPSIS</a></li>
	<li><a href="#description">DESCRIPTION</a></li>
	<li><a href="#functions">FUNCTIONS</a></li>
	<ul>

		<li><a href="#decode__"><code>decode()</code></a></li>
		<ul>

			<li><a href="#return_values">Return Values</a></li>
		</ul>

	</ul>

	<li><a href="#caveats">CAVEATS</a></li>
	<li><a href="#see_also">SEE ALSO</a></li>
	<li><a href="#author">AUTHOR</a></li>
	<li><a href="#contact">CONTACT</a></li>
	<li><a href="#copyright">COPYRIGHT</a></li>
</ul>
<!-- INDEX END -->

<hr />
<p>
</p>
<h1><a name="name">NAME</a></h1>
<p>Net::sFlow - decode sFlow datagrams</p>
<p>
</p>
<hr />
<h1><a name="synopsis">SYNOPSIS</a></h1>
<pre>
  use Net::sFlow;
  use IO::Socket::INET;
  
  my $sock = IO::Socket::INET-&gt;new( LocalPort =&gt; '6343',
                                    Proto     =&gt; 'udp')
                               or die &quot;Can't bind : $@\n&quot;;</pre>
<pre>
  while ($sock-&gt;recv($packet,1548)) {
    &amp;processPacket($packet);
  }
  die &quot;Socket recv: $!&quot;;</pre>
<pre>
  sub processPacket {</pre>
<pre>
    my $sFlowPacket = shift;</pre>
<pre>
    # now we actually call the Net::sFlow::decode() function
    my ($sFlowDatagramRef, $sFlowSamplesRef, $errorsRef) = Net::sFlow::decode($sFlowPacket);</pre>
<pre>
    # print errors
      foreach my $error (@{$errorsRef}) {
      warn &quot;$error&quot;;
    }</pre>
<pre>
    # print sflow data
    print &quot;===Datagram===\n&quot;;
    print &quot;sFlow version: $sFlowDatagramRef-&gt;{sFlowVersion}\n&quot;;
    print &quot;datagram sequence number: $sFlowDatagramRef-&gt;{datagramSequenceNumber}\n&quot;;</pre>
<pre>
    foreach my $sFlowSample (@{$printSamplesRef}) {
      print &quot;\n&quot;;
      print &quot;---Sample---\n&quot;;
      print &quot;sample sequence number: $sFlowSample-&gt;{sampleSequenceNumber}\n&quot;;
    }</pre>
<pre>
  }</pre>
<p>
</p>
<hr />
<h1><a name="description">DESCRIPTION</a></h1>
<p>The sFlow module provides a mechanism to parse and decode sFlow
datagrams. It supports sFlow version 2/4 (RFC 3176 -
<a href="http://www.ietf.org/rfc/rfc3176.txt)">http://www.ietf.org/rfc/rfc3176.txt)</a> and sFlow version 5 (Memo -
<a href="http://sflow.org/sflow_version_5.txt).">http://sflow.org/sflow_version_5.txt).</a></p>
<p>The module's functionality is provided by a single (exportable)
function, <a href="#decode__">decode()</a>.</p>
<p>For more examples have a look into the 'examples' directory.</p>
<p>
</p>
<hr />
<h1><a name="functions">FUNCTIONS</a></h1>
<p>
</p>
<h2><a name="decode__"><code>decode()</code></a></h2>
<pre>

($datagram, $samples, $error) = Net::sFlow::decode($udp_data);</pre>
<p>Returns a HASH reference containing the datagram data, 
an ARRAY reference with the sample data (each array element contains a HASH reference for one sample)
and in case of an error a reference to an ARRAY containing the error messages.</p>
<p>
</p>
<h3><a name="return_values">Return Values</a></h3>
<dl>
<dt><strong><a name="item__24datagram"><em>$datagram</em></a></strong><br />
</dt>
<dd>
A HASH reference containing information about the sFlow datagram, with
the following keys:
</dd>
<dd>
<pre>
  sFlowVersion
  AgentIpVersion
  AgentIp
  datagramSequenceNumber
  agentUptime
  samplesInPacket</pre>
</dd>
<dd>
<p>In the case of sFlow v5, there is an additional key:</p>
</dd>
<dd>
<pre>
  subAgentId</pre>
</dd>
<p></p>
<dt><strong><a name="item__24samples"><em>$samples</em></a></strong><br />
</dt>
<dd>
Reference to a list of HASH references, each one representing one
sample. Depending on the sFlow version and type of hardware where the data comes from 
(router, switch, etc.), the hash contains the following additional keys:
</dd>
<dd>
<p>In case of sFlow &lt;= 4:</p>
</dd>
<dd>
<pre>
  sampleType
  sampleSequenceNumber
  sourceIdType
  sourceIdIndex</pre>
</dd>
<dd>
<p>If it's a sFlow &lt;= 4 <em>flowsample</em> you will get the following additional keys:</p>
</dd>
<dd>
<pre>
  samplingRate
  samplePool
  drops
  inputInterface
  outputInterface
  packetDataType
  extendedDataInSample</pre>
</dd>
<dd>
<p>If it's a sFlow &lt;= 4 <em>countersample</em> you will get these additional keys:</p>
</dd>
<dd>
<pre>
  counterSamplingInterval
  countersVersion</pre>
</dd>
<dd>
<p>In case of sFlow &gt;= 5 you will first get enterprise, format and length information:</p>
</dd>
<dd>
<pre>
  sampleTypeEnterprise
  sampleTypeFormat
  sampleLength</pre>
</dd>
<dd>
<p>In case of a <em>flowsample</em> (enterprise == 0 and format == 1):</p>
</dd>
<dd>
<pre>
  sampleSequenceNumber
  sourceIdType
  sourceIdIndex
  samplingRate
  samplePool
  drops
  inputInterface
  outputInterface
  flowRecordsCount</pre>
</dd>
<dd>
<p>If it's an <em>expanded flowsample</em> (enterprise == 0 and format == 3)
you will get these additional keys instead of inputInterface and outputInterface:</p>
</dd>
<dd>
<pre>
  inputInterfaceFormat
  inputInterfaceValue
  outputInterfaceFormat
  outputInterfaceValue</pre>
</dd>
<dd>
<p>In case of a <em>countersample</em> (enterprise == 0 and format == 2) or
an <em>expanded countersample</em> (enterprise == 0 and format == 4):</p>
</dd>
<dd>
<pre>
  sampleSequenceNumber
  sourceIdType
  sourceIdIndex
  counterRecordsCount
  counterDataLength</pre>
</dd>
<dd>
<p>Depending on the hardware you can get the following additional keys:</p>
</dd>
<dd>
<p>Header data (sFlow format):</p>
</dd>
<dd>
<pre>
  HEADERDATA
  HeaderProtocol
  HeaderFrameLength 
  HeaderStrippedLength
  HeaderSizeByte
  HeaderSizeBit
  HeaderBin</pre>
</dd>
<dd>
<p>Additional Header data decoded from the raw packet header:</p>
</dd>
<dd>
<pre>
  HeaderEtherSrcMac
  HeaderEtherDestMac
  HeaderType (ether type)
  HeaderDatalen (of the whole packet including ethernet header)</pre>
</dd>
<dd>
<p>Ethernet frame data:</p>
</dd>
<dd>
<pre>
  ETHERNETFRAMEDATA
  EtherMacPacketlength
  EtherSrcMac
  EtherDestMac
  EtherPackettype</pre>
</dd>
<dd>
<p>IPv4 data:</p>
</dd>
<dd>
<pre>
  IPv4DATA
  IPv4Packetlength
  IPv4NextHeaderProtocol
  IPv4srcIp
  IPv4destIp
  IPv4srcPort
  IPv4destPort
  IPv4tcpFlags
  IPv4tos</pre>
</dd>
<dd>
<p>IPv6 data:</p>
</dd>
<dd>
<pre>
  IPv6DATA
  IPv6Packetlength
  IPv6NextHeaderProto
  IPv6srcIp
  IPv6destIp
  IPv6srcPort
  IPv6destPort
  IPv6tcpFlags
  IPv6Priority</pre>
</dd>
<dd>
<p>Switch data:</p>
</dd>
<dd>
<pre>
  SWITCHDATA
  SwitchSrcVlan
  SwitchSrcPriority
  SwitchDestVlan
  SwitchDestPriority</pre>
</dd>
<dd>
<p>Router data:</p>
</dd>
<dd>
<pre>
  ROUTERDATA
  RouterIpVersionNextHopRouter
  RouterIpAddressNextHopRouter
  RouterSrcMask
  RouterDestMask</pre>
</dd>
<dd>
<p>Gateway data:</p>
</dd>
<dd>
<pre>
  GATEWAYDATA
  GatewayIpVersionNextHopRouter (only in case of sFlow v5)
  GatewayIpAddressNextHopRouter (only in case of sFlow v5)
  GatewayAsRouter
  GatewayAsSource
  GatewayAsSourcePeer
  GatewayDestAsPathsCount</pre>
</dd>
<dd>
<pre>
  GatewayDestAsPaths (arrayreference)
    each enty contains a hashreference:
      asPathSegmentType
      lengthAsList
      AsPath (arrayreference, asNumbers as entries)</pre>
</dd>
<dd>
<pre>
  GatewayLengthCommunitiesList (added in sFlow v4)
  GatewayCommunities (arrayreference, added in sFlow v4)
    each enty contains a community (added in sFlow v4)</pre>
</dd>
<dd>
<pre>
  localPref</pre>
</dd>
<dd>
<p>User data:</p>
</dd>
<dd>
<pre>
  USERDATA
  UserSrcCharset (only in case of sFlow v5)
  UserLengthSrcString
  UserSrcString
  UserDestCharset (only in case of sFlow v5)
  UserLengthDestString
  UserDestString</pre>
</dd>
<dd>
<p>Url data (added in sFlow v3):</p>
</dd>
<dd>
<pre>
  URLDATA
  UrlDirection
  UrlLength
  Url
  UrlHostLength (only in case of sFlow v5)
  UrlHost (only in case of sFlow v5)</pre>
</dd>
<dd>
<p>The following keys can be only available in sFlow v5:</p>
</dd>
<dd>
<p>Mpls data:</p>
</dd>
<dd>
<pre>
  MPLSDATA
  MplsIpVersionNextHopRouter
  MplsIpAddressNextHopRouter
  MplsInLabelStackCount
  MplsInLabelStack (arrayreference containing MplsInLabels)
  MplsOutLabelStackCount
  MplsOutLabelStack (arrayreference containing MplsOutLabels)</pre>
</dd>
<dd>
<p>Nat data:</p>
</dd>
<dd>
<pre>
  NATDATA
  NatIpVersionSrcAddress
  NatSrcAddress
  NatIpVersionDestAddress
  NatDestAddress</pre>
</dd>
<dd>
<p>Mpls tunnel:</p>
</dd>
<dd>
<pre>
  MPLSTUNNEL
  MplsTunnelLength
  MplsTunnelName
  MplsTunnelId
  MplsTunnelCosValue</pre>
</dd>
<dd>
<p>Mpls vc:</p>
</dd>
<dd>
<pre>
  MPLSVC
  MplsVcInstanceNameLength
  MplsVcInstanceName
  MplsVcId
  MplsVcLabelCosValue</pre>
</dd>
<dd>
<p>Mpls fec:</p>
</dd>
<dd>
<pre>
  MPLSFEC
  MplsFtnDescrLength
  MplsFtnDescr
  MplsFtnMask</pre>
</dd>
<dd>
<p>Mpls lpv fec:</p>
</dd>
<dd>
<pre>
  MPLSLPVFEC
  MplsFecAddrPrefixLength</pre>
</dd>
<dd>
<p>Vlan tunnel:</p>
</dd>
<dd>
<pre>
  VLANTUNNEL
  VlanTunnelLayerStackCount
  VlanTunnelLayerStack (arrayreference containing VlanTunnelLayer entries)</pre>
</dd>
<dd>
<p>The following keys are also available in sFlow &lt; 5:</p>
</dd>
<dd>
<p>Counter generic:</p>
</dd>
<dd>
<pre>
  COUNTERGENERIC
  ifIndex
  ifType
  ifSpeed
  ifDirection
  ifAdminStatus
  ifOperStatus
  ifInOctets
  ifInUcastPkts
  ifInMulticastPkts
  ifInBroadcastPkts
  ifInDiscards
  ifInErrors
  ifInUnknownProtos
  ifOutOctets
  ifOutUcastPkts
  ifOutMulticastPkts
  ifOutBroadcastPkts
  ifOutDiscards
  ifOutErrors
  ifPromiscuousMode</pre>
</dd>
<dd>
<p>Counter ethernet:</p>
</dd>
<dd>
<pre>
  COUNTERETHERNET
  dot3StatsAlignmentErrors
  dot3StatsFCSErrors
  dot3StatsSingleCollisionFrames
  dot3StatsMultipleCollisionFrames
  dot3StatsSQETestErrors
  dot3StatsDeferredTransmissions
  dot3StatsLateCollisions
  dot3StatsExcessiveCollisions
  dot3StatsInternalMacTransmitErrors
  dot3StatsCarrierSenseErrors
  dot3StatsFrameTooLongs
  dot3StatsInternalMacReceiveErrors
  dot3StatsSymbolErrors</pre>
</dd>
<dd>
<p>Counter tokenring:</p>
</dd>
<dd>
<pre>
  COUNTERTOKENRING
  dot5StatsLineErrors
  dot5StatsBurstErrors
  dot5StatsACErrors
  dot5StatsAbortTransErrors
  dot5StatsInternalErrors
  dot5StatsLostFrameErrors
  dot5StatsReceiveCongestions
  dot5StatsFrameCopiedErrors
  dot5StatsTokenErrors
  dot5StatsSoftErrors
  dot5StatsHardErrors
  dot5StatsSignalLoss
  dot5StatsTransmitBeacons
  dot5StatsRecoverys
  dot5StatsLobeWires
  dot5StatsRemoves
  dot5StatsSingles
  dot5StatsFreqErrors</pre>
</dd>
<dd>
<p>Counter vg:</p>
</dd>
<dd>
<pre>
  COUNTERVG
  dot12InHighPriorityFrames
  dot12InHighPriorityOctets
  dot12InNormPriorityFrames
  dot12InNormPriorityOctets
  dot12InIPMErrors
  dot12InOversizeFrameErrors
  dot12InDataErrors
  dot12InNullAddressedFrames
  dot12OutHighPriorityFrames
  dot12OutHighPriorityOctets
  dot12TransitionIntoTrainings
  dot12HCInHighPriorityOctets
  dot12HCInNormPriorityOctets
  dot12HCOutHighPriorityOctets</pre>
</dd>
<dd>
<p>Counter vlan:</p>
</dd>
<dd>
<pre>
  COUNTERVLAN
  vlan_id
  octets
  ucastPkts
  multicastPkts
  broadcastPkts
  discards</pre>
</dd>
<dd>
<p>Counter processor (only in sFlow v5):</p>
</dd>
<dd>
<pre>
  COUNTERPROCESSOR
  cpu5s
  cpu1m
  cpu5m
  memoryTotal
  memoryFree</pre>
</dd>
<p></p>
<dt><strong><a name="item__24error"><em>$error</em></a></strong><br />
</dt>
<dd>
Reference to a list of error messages.
</dd>
<p></p></dl>
<p>
</p>
<hr />
<h1><a name="caveats">CAVEATS</a></h1>
<p>The <a href="#decode__">decode()</a> function will blindly attempt to decode the data
you provide. There are some tests for the appropriate values at various
places (where it is feasible to test - like enterprises,
formats, versionnumbers, etc.), but in general the GIGO principle still
stands: Garbage In / Garbage Out.</p>
<p>
</p>
<hr />
<h1><a name="see_also">SEE ALSO</a></h1>
<p>sFlow v4
<a href="http://www.ietf.org/rfc/rfc3176.txt">http://www.ietf.org/rfc/rfc3176.txt</a></p>
<p>Format Diagram v4:
<a href="http://jasinska.de/sFlow/sFlowV4FormatDiagram/">http://jasinska.de/sFlow/sFlowV4FormatDiagram/</a>

</p>
<p>sFlow v5
<a href="http://sflow.org/sflow_version_5.txt">http://sflow.org/sflow_version_5.txt</a>

</p>
<p>Format Diagram v5:
<a href="http://jasinska.de/sFlow/sFlowV5FormatDiagram/">http://jasinska.de/sFlow/sFlowV5FormatDiagram/</a>

</p>
<p>Math::BigInt

</p>
<p>
</p>
<hr />
<h1><a name="author">AUTHOR</a></h1>
<p>Elisa Jasinska &lt;<a href="mailto:elisa.jasinska@ams-ix.net">elisa.jasinska@ams-ix.net</a>&gt;

</p>
<p>
</p>
<hr />
<h1><a name="contact">CONTACT</a></h1>
<p>Please send comments or bug reports to &lt;<a href="mailto:sflow@ams-ix.net">sflow@ams-ix.net</a>&gt;

</p>
<p>
</p>
<hr />
<h1><a name="copyright">COPYRIGHT</a></h1>
<p>Copyright (c) 2007 AMS-IX B.V.

</p>
<p>This package is free software and is provided ``as is'' without express 
or implied warranty.  It may be used, redistributed and/or modified 
under the terms of the Perl Artistic License (see
<a href="http://www.perl.com/perl/misc/Artistic.html)">http://www.perl.com/perl/misc/Artistic.html)</a>

</p>

</body>

</html>
